(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-common"],{"3dfd":function(e,t,s){"use strict";var i=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{attrs:{id:"app"}},[s("div",{attrs:{id:"container"}},[s("sui-form",{attrs:{id:"input-form"}},[s("sui-header",{attrs:{sub:""}},[e._v("Users")]),s("UsersInput",{attrs:{userHistory:e.userHistory},model:{value:e.usersInput,callback:function(t){e.usersInput=t},expression:"usersInput"}}),s("sui-header",{attrs:{sub:""}},[e._v("Settings")]),s("Settings",{attrs:{titleFormat:e.titleFormat,minShared:e.minShared,allShared:e.allShared,hideSeen:e.hideSeen,dark:e.dark},on:{inputFormat:function(t){e.titleFormat=t},inputMinShared:function(t){e.minShared=t},inputAllShared:function(t){e.allShared=t},clearHistory:e.clearUserHistory,inputHideSeen:function(t){e.hideSeen=t},inputDark:function(t){e.dark=t}}})],1),s("sui-divider"),s("Messages",{attrs:{messages:e.messages},on:{dismiss:e.dismissMessage}}),s("EntryList",{attrs:{entries:e.entries,users:e.orderedUsers,minShared:e.minShared,hideSeen:e.hideSeen,allShared:e.allShared},on:{updateHidden:function(t){e.hiddenEntries=t}}}),s("footer",[e._v("\n      Made by "),s("a",{attrs:{href:"https://github.com/FichteFoll",target:"_blank"}},[e._v("FichteFoll")]),e._v(";\n      Open Source @\n      "),s("a",{attrs:{href:"https://github.com/FichteFoll/anitogether",target:"_blank"}},[s("sui-icon",{attrs:{name:"github"}}),e._v(" GitHub\n      ")],1)])],1)])},r=[],n=s("2b0e"),a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("sui-table",{staticClass:"entry-table",attrs:{definition:"",celled:"",compact:"",unstackable:"",selectable:""}},[s("sui-table-header",[s("sui-table-row",[s("sui-table-header-cell",[e._v("Anime")]),e._l(e.users,(function(e){return s("sui-table-header-cell",{key:e.name,attrs:{collapsing:"",textAlign:"right"}},[s("a",{attrs:{href:"https://anilist.co/user/"+e.name,target:"_blank"}},[s("sui-image",{attrs:{rounded:"",size:"mini",src:e.avatar.medium,title:e.name}})],1)])})),s("sui-table-header-cell",{attrs:{collapsing:"",textAlign:"right"}},[e._v("\n        Latest\n      ")]),s("sui-table-header-cell",{staticClass:"select-shows",attrs:{collapsing:"",textAlign:"center"}},[s("transition",{attrs:{name:"colfade"}},[e.hideSelectActive?s("div",{staticClass:"animate"},[e._v("\n            Show "),s("br"),e._v(" / Hide\n          ")]):e._e()])],1)],2)],1),s("transition-group",{attrs:{name:"rowfade",tag:"tbody"}},e._l(e.entries,(function(t){return e.isBelowThreshold(t)||e.isSeen(t)||!t.media.visible&&!e.hideSelectActive?e._e():s("Entry",{key:t.media.id,attrs:{entry:t,users:e.users,hideSelectActive:e.hideSelectActive}})})),1),s("sui-table-footer",{attrs:{fullWidth:""}},[s("sui-table-header-cell",{attrs:{colspan:3+e.users.length}},[s("sui-button",{attrs:{compact:"",size:"small",floated:"right",primary:e.hideSelectActive},on:{click:e.toggleHiddenEntries}},[e._v("\n        "+e._s(e.hideSelectActive?"Hide shows":"Select shows")+"\n      ")]),s("span",{staticClass:"stats",domProps:{innerHTML:e._s(e.statsString)}})],1)],1)],1)},o=[],l=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("sui-table-row",{staticClass:"entry"},[s("sui-table-header-cell",{staticClass:"title",class:{releasing:"RELEASING"===e.entry.media.status},attrs:{title:"RELEASING"===e.entry.media.status?"Releasing":""}},[s("transition",{attrs:{name:"title",mode:"out-in"}},[s("div",{key:e.entry.media.title.userPreferred,staticClass:"animate"},[s("a",{attrs:{href:"https://anilist.co/anime/"+e.entry.media.id,target:"_blank"}},[e._v("\n          "+e._s(e.entry.media.title.userPreferred)+"\n        ")])])])],1),e._l(e.users,(function(t){return e.entry.users.has(t.name)?s("sui-table-cell",{key:t.name,staticClass:"episode progress",class:{paused:"PAUSED"===e.entry.users.get(t.name).status,negative:e.entry.users.get(t.name).progress!==e.entry.maxEpisode},attrs:{collapsing:"",textAlign:"right",title:"Score: "+e.entry.users.get(t.name).score+" / 10"}},[s("div",{staticClass:"animate"},[e._v("\n      "+e._s(e.entry.users.get(t.name).progress||"0")+"\n    ")])]):s("sui-table-cell")})),s("sui-table-cell",{staticClass:"episode latest",class:{positive:e.entry.maxEpisode!==e.entry.media.latestEpisode},attrs:{collapsing:"",textAlign:"right"}},[s("div",{staticClass:"animate",attrs:{title:e.entry.media.latestEpisode+" / "+e.entry.media.episodes}},[e._v("\n      "+e._s(e.entry.media.latestEpisode)+"\n    ")])]),s("sui-table-header-cell",{attrs:{collapsing:""}},[s("transition",{attrs:{name:"colfade"}},[e.hideSelectActive?s("div",{staticClass:"animate"},[s("sui-checkbox",{attrs:{toggle:""},model:{value:e.entry.media.visible,callback:function(t){e.$set(e.entry.media,"visible",t)},expression:"entry.media.visible"}})],1):e._e()])],1)],2)},u=[],c={props:{entry:Object,users:Array,hideSelectActive:Boolean}},d=c,h=(s("ffd1"),s("2877")),m=Object(h["a"])(d,l,u,!1,null,null,null),p=m.exports,f={components:{Entry:p},props:{entries:Array,users:Array,minShared:Number,hideSeen:Boolean,allShared:Boolean},data(){return{hideSelectActive:!1}},computed:{stats(){const e=this.entries.filter(e=>!this.isBelowThreshold(e)),t=e.filter(e=>!this.isSeen(e)),s=t.filter(({media:e})=>e.visible),i=s.filter(({media:e})=>"RELEASING"===e.status);return{total:s.length,releasing:i.length,hidden:t.length-s.length,belowThreshold:this.entries.length-e.length,seen:e.length-t.length}},statsString(){const e=this.users.length>1&&(this.allShared||this.minShared>1),t=[[this.stats.total,(e?"shared ":"")+"anime"],[this.stats.releasing,"releasing"],[this.stats.hidden,"hidden"],[this.stats.belowThreshold,"below threshold"],[this.stats.seen,"up to date"]];return t.filter(([e],t)=>0===t||e>0).map(e=>e.join(" ")).join(", ")}},methods:{toggleHiddenEntries(){if(this.hideSelectActive=!this.hideSelectActive,!this.hideSelectActive){const e=this.entries.filter(({media:e})=>!e.visible).map(({media:e})=>e.id);this.$emit("updateHidden",e)}},isBelowThreshold(e){return this.users.length>1&&(this.allShared?e.users.size<this.users.length:e.users.size<Math.min(this.minShared,this.users.length))},isSeen(e){if(this.hideSeen){const t=Array.from(e.users.values());return t.every(t=>t.progress===e.media.latestEpisode)}return!1}}},g=f,S=(s("7388"),Object(h["a"])(g,a,o,!1,null,null,null)),b=S.exports,v=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{attrs:{id:"messages"}},e._l(e.messages,(function(t,i){return s("sui-message",{key:t.text,class:["error"===t.kind?"negative":t.kind],attrs:{header:t.title||"",content:t.text+(t.count>1?" ("+t.count+")":""),dismissable:""},on:{dismiss:function(t){return e.$emit("dismiss",i)}}})})),1)},y=[],_={props:{messages:Array}},E=_,k=Object(h["a"])(E,v,y,!1,null,null,null),A=k.exports,w=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("sui-form-fields",[s("sui-form-field",[s("label",[e._v("Title format")]),s("sui-form-fields",{attrs:{inline:""}},e._l(e.formats,(function(t){return s("sui-form-field",{key:t.value},[s("sui-checkbox",{attrs:{radio:"",label:t.label,value:t.value},on:{change:function(t){return e.$emit("inputFormat",t)}},model:{value:e.current,callback:function(t){e.current=t},expression:"current"}})],1)})),1)],1),s("sui-form-field",[s("label",[e._v("Minimum users for shared anime")]),s("sui-form-fields",{attrs:{inline:""}},[s("sui-form-field",[s("sui-input",{attrs:{type:"number",value:e.minShared,disabled:e.allShared},on:{input:function(t){e.$emit("inputMinShared",Number(t))}}})],1),s("sui-form-field",[s("sui-checkbox",{attrs:{label:"All",inputValue:e.allShared},on:{change:function(t){return e.$emit("inputAllShared",t)}}})],1)],1)],1),s("sui-form-field",[s("label",[e._v("History")]),s("sui-button",{attrs:{floated:"right",icon:"delete",compact:""},on:{click:function(t){return e.$emit("clearHistory")}}},[e._v("\n      Clear history\n    ")])],1),s("sui-form-field",[s("label",[e._v("Other")]),s("sui-checkbox",{attrs:{label:"Hide seen by all",inputValue:e.hideSeen},on:{change:function(t){return e.$emit("inputHideSeen",t)}}}),s("sui-checkbox",{attrs:{label:"Dark mode",inputValue:e.dark},on:{change:function(t){return e.$emit("inputDark",t)}}})],1)],1)},H=[],x={props:{minShared:Number,allShared:Boolean,titleFormat:String,hideSeen:Boolean,dark:Boolean},data(){return{current:this.titleFormat,formats:[{label:"Romaji",value:"romaji"},{label:"English",value:"english"},{label:"Native",value:"native"}]}},watch:{titleFormat(){this.current=this.titleFormat}}},j=x,I=Object(h["a"])(j,w,H,!1,null,null,null),M=I.exports,$=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("sui-form-field",[s("sui-dropdown",{attrs:{multiple:"",placeholder:"Search usersâ€¦",search:"",fluid:"",selection:"",options:e.options,"allow-additions":"",value:e.value},on:{input:function(t){return e.$emit("input",t)}}})],1)},L=[],O={props:{value:Array,userHistory:Array},computed:{options(){return this.userHistory.map(e=>({text:e,value:e}))}}},C=O,F=Object(h["a"])(C,$,L,!1,null,null,null),U=F.exports;function N(e){let t="query WatchingProgress($status: [MediaListStatus]) {\n";const s=2;let i=0;for(const[r,n]of e.entries()){const e=`      user${r}: MediaListCollection(status_in: $status, userName: "${n}", type: ANIME) {\n        user {\n          id\n          name\n          avatar {\n            medium\n          }\n        }\n        lists {\n          entries {\n            media {\n              id\n              title {\n                romaji\n                english\n                native\n              }\n              episodes\n              nextAiringEpisode {\n                episode\n              }\n              status\n            }\n            status\n            score\n            progress\n          }\n        }\n      }\n`;0===i&&(i=e.split("\n").length-1),t+=e}return t+="}",{query:t,tmplOffset:s,tmplLen:i}}function P(e,t){const s="https://graphql.anilist.co",i={status:t},{query:r,tmplOffset:n,tmplLen:a}=N(e),o={method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({query:r,variables:i})};return fetch(s,o).then(e=>e.json().then(t=>e.ok?t:Promise.reject(t))).catch(t=>{if(t.errors)for(const s of t.errors){const{message:t,locations:i}=s;if("User not found"===t){const[{line:t}]=i,r=(t-n)/a;s.message=`User ${e[Math.floor(r)]} not found`}}return Promise.reject(t)})}const T="light.html";function B(e){const t=e.split(",").map(e=>e.trim()),s=new Set(t);return s.delete(""),[...s]}const R={users:[],format:"romaji",minShared:2,hideSeen:!0,all:!1,hide:[]};var z={components:{EntryList:b,Messages:A,Settings:M,UsersInput:U},data(){return{cache:{},sourceEntries:{},users:{},usersInput:R.users,userHistory:[],titleFormat:R.format,minShared:R.minShared,allShared:R.all,hiddenEntries:R.hide,hideSeen:R.hideSeen,dark:!location.pathname.endsWith(T),messages:[],oldParams:R}},created(){try{const e=localStorage.getItem("userHistory")||"";""!==e&&(this.userHistory=e.split(",")),localStorage.removeItem("dark")}catch(e){console.warn("Unable to access localStorage")}this.loadHash(),window.addEventListener("hashchange",this.loadHash)},computed:{entries(){const e=new Map;for(const[s,i]of Object.entries(this.sourceEntries))for(const{media:t,...r}of i)e.has(t.id)||(t.latestEpisode||(t.latestEpisode=t.nextAiringEpisode&&t.nextAiringEpisode.episode>0?t.nextAiringEpisode.episode-1:t.episodes||"?"),e.set(t.id,{media:t,users:new Map})),e.get(t.id).users.set(s,r);for(const s of e.values()){const e=[...s.users.values()];s.maxEpisode=Math.max(...e.map(e=>e.progress)),s.media.visible=-1===this.hiddenEntries.indexOf(s.media.id),s.media.title.userPreferred=this.getMediaTitle(s.media)}const t=[...e.values()];return t.sort((e,t)=>e.media.title.userPreferred.localeCompare(t.media.title.userPreferred,"ja")),t},orderedUsers(){const e=[];for(const t of this.usersInput)this.users[t]&&e.push(this.users[t]);return e}},watch:{userHistory(){try{localStorage.setItem("userHistory",this.userHistory.join(","))}catch(e){console.warn("Unable to set localStorage")}},minShared(){this.updateLocation()},usersInput(){this.updateLocation(),this.fetchLists()},titleFormat(){this.updateLocation()},hiddenEntries(){this.updateLocation()},hideSeen(){this.updateLocation()},allShared(){this.updateLocation()},dark(){this.updateLocation()}},methods:{fetchLists(){const e=this.usersInput;if(0===e.length)return;this.updateUserHistory(e);const t=new Set(Object.keys(this.cache)),s=e.filter(e=>!t.has(e));0!==s.length?(console.log("fetching info for",s),P(s,"CURRENT").then(e=>{console.log("results for users",s,e);for(const t of Object.values(e.data)){const e=t.user,s=t.lists.reduce((e,t)=>e.concat(t.entries),[]);0!==s.length?n["a"].set(this.cache,e.name,[e,s]):this.showMessage("warning",e.name+"'s list is empty")}this.finalizeUpdate()}).catch(e=>{if(e instanceof Error)this.showMessage(e.message);else if(e.errors)for(const{message:t}of e.errors)this.showMessage("error",t);else console.error("fetch error",e)})):this.finalizeUpdate()},finalizeUpdate(){const e={},t={};for(const s of this.usersInput){const[i,r]=this.cache[s];e[s]=r,t[s]=i}this.sourceEntries=e,this.users=t,document.title="AniTogether - "+this.usersInput.join(", "),console.log("update done for",this.usersInput)},updateUserHistory(e){const t=new Set([...this.userHistory,...e]),s=[...t];s.sort((e,t)=>e.localeCompare(t)),this.userHistory.toString()!==s.toString()&&(this.userHistory=s)},clearUserHistory(){this.userHistory=[]},getMediaTitle(e){return e.title[this.titleFormat]||e.title.romaji},loadHash(){const e=(e,t)=>{const s=this[e];return JSON.stringify(s)!==JSON.stringify(t)&&(this[e]=t,!0)},t={users:B,minShared:Number,hideSeen:e=>"true"==e,all:e=>"true"==e,hide:e=>B(e).map(Number)},s=location.hash.substring(1).split("&").filter(e=>""!==e).reduce((e,s)=>{const[i,r]=s.split("="),n=t[i]||(e=>e);return e[i]=n(decodeURIComponent(r)),e},{}),i={...R,...s};e("oldParams",i)&&(e("usersInput",i.users),e("titleFormat",i.format),e("minShared",i.minShared),e("hideSeen",i.hideSeen),e("allShared",i.all),e("hiddenEntries",i.hide))},updateLocation(){const e={...R,users:this.usersInput.join(","),format:this.titleFormat,minShared:this.minShared,hideSeen:this.hideSeen,all:this.allShared,hide:this.hiddenEntries.join(",")},t=new Set(["users"]),s="#"+Object.entries(e).filter(([e,t])=>t!=R[e]).map(([e,t])=>`${e}=${encodeURIComponent(t)}`).join("&");let i=Object.entries(e).filter(([e,t])=>t!=this.oldParams[e]).every(([e])=>t.has(e)),r=location.pathname;r.endsWith(T)&&this.dark?(r=r.substring(0,r.length-T.length),i=!1):r.endsWith(T)||this.dark||(r+=T,i=!1);const n=location.origin+r+location.search+s;i?location.assign(n):location.replace(n),this.oldParams=e},showMessage(e,t,s){if(t&&""!==t){for(const e of this.messages)if(e.text===t)return void(e.count+=1);this.messages.push({kind:e,text:t,title:s,count:1})}},dismissMessage(e){this.messages.splice(e,1)}}},q=z,J=(s("cf25"),Object(h["a"])(q,i,r,!1,null,null,null));t["a"]=J.exports},"4cb3":function(e,t,s){},"56cc":function(e,t,s){},7388:function(e,t,s){"use strict";var i=s("acc9"),r=s.n(i);r.a},acc9:function(e,t,s){},cf25:function(e,t,s){"use strict";var i=s("56cc"),r=s.n(i);r.a},ffd1:function(e,t,s){"use strict";var i=s("4cb3"),r=s.n(i);r.a}}]);
//# sourceMappingURL=chunk-common.6175ed26.js.map