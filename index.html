<!DOCTYPE html>
<html>
<head>
  <title>AniTogether</title>
  <meta charset="utf-8">
  <!-- <link rel="stylesheet" type="text/css" href=""> -->

  <!-- development version, includes helpful console warnings -->
  <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
  <script src="./query.js"></script>
</head>

<body onhashchange="app.fetchLists()">
  <div id="app">
      <input type="text"
          v-model.lazy="usersInput"
          @change="fetchLists"
          placeholder="Anilist usernames, separated by comma">
    <table>
      <thead>
        <tr>
          <th>Anime</th>
          <th v-for="user in sortedUsers">
            {{ user.name }}
          </th>
          <th>
            Latest
          </th>
        </tr>
      </thead>
      <tbody>
        <tr v-for="entry in entries"
            v-if="entry.users.size > 1"
            class="title"
            v-bind:class="{releasing: entry.media.status === 'RELEASING',
                           finished: entry.media.status === 'FINISHED'}">
          <td>
            {{ entry.media.title.userPreferred }}
          </td>
          <td v-for="user in sortedUsers"
              v-if="entry.users.has(user.name)"
              class="progress"
              v-bind:class="{paused: entry.users.get(user.name).status === 'PAUSED',
                             latest: entry.users.get(user.name).progress === entry.media.latestEpisode }"
              v-bind:title="entry.users.get(user.name).score + ' / 10'">
            {{ entry.users.get(user.name).progress || "" }}
          </td>
          <td v-else></td>
          <td>
            {{ entry.media.latestEpisode }}
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <script src="./app.js"></script>
</body>
</html>
