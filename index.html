<!DOCTYPE html>
<html>
<head>
  <title>AniTogether</title>
  <meta charset="utf-8">

  <!-- Vue.js; development version (includes helpful console warnings) -->
  <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>

  <!-- UI framework -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/semantic-ui@2.4.2/dist/semantic.min.css">
  <script src="https://cdn.jsdelivr.net/npm/semantic-ui@2.4.2/dist/semantic.min.js"></script>

  <!-- Custom -->
  <script src="./query.js"></script>
  <style type="text/css">
    .progress {
      text-align: right;
    }

    .title.positive {
      color: hsl(93, 72%, 25%);
    }

    .avatar {
      width: 32px;
      height: 32px;
    }
  </style>
  <!-- <link rel="stylesheet" type="text/css" href="./style.css"> -->
</head>

<body onhashchange="app.fetchLists()">
  <div id="app">
      <input type="text"
          v-model.lazy="usersInput"
          @change="fetchLists"
          placeholder="Anilist usernames, separated by comma">
    <table class="ui table celled definition compact">
      <thead>
        <tr>
          <th>Anime</th>
          <th v-for="user in sortedUsers">
            <!-- TODO avatar -->
            <img class="avatar"
                v-bind:src="user.avatar.medium"
                v-bind:title="user.name">
            <!-- {{ user.name }} -->
          </th>
          <th>
            Latest
          </th>
        </tr>
      </thead>
      <tbody>
        <tr v-for="entry in entries"
            v-if="entry.users.size > 1">
          <th class="title"
              v-bind:class="{positive: entry.media.status === 'RELEASING',
                             finished: entry.media.status === 'FINISHED'}">
            {{ entry.media.title.userPreferred }}
          </th>
          <td v-for="user in sortedUsers"
              v-if="entry.users.has(user.name)"
              class="progress"
              v-bind:class="{paused: entry.users.get(user.name).status === 'PAUSED',
                             negative: entry.users.get(user.name).progress !== entry.maxEpisode }"
              v-bind:title="entry.users.get(user.name).score + ' / 10'">
            {{ entry.users.get(user.name).progress || "" }}
          </td>
          <td v-else></td>
          <td v-bind:class="{ negative: entry.maxEpisode !== entry.media.latestEpisode }">
            {{ entry.media.latestEpisode }}
          </td>
        </tr>
      </tbody>
      <!-- TODO footer with buttons to show/hide selected shows -->
    </table>
  </div>

  <script src="./app.js"></script>
</body>
</html>
